{% load static %}
<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Fly Track — Cadastrar Voo</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#edf6fb; --card:#fff; --ink:#0b1e45; --muted:#3a5674; --line:#e5eef6;
      --accent:#2f80ed; --cta:#ff5a00; --cta-ink:#fff; --pill:#f7fbff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:1200px;margin:28px auto;padding:0 18px}

    /* topo */
    .nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{font-weight:800;letter-spacing:.2px}
    .nav ul{list-style:none;margin:0;padding:0;display:flex;gap:20px;align-items:center}
    .nav a{color:var(--ink);text-decoration:none;font-weight:600}
    .logout{background:#fff;border:1px solid var(--line);padding:8px 14px;border-radius:999px}

    /* layout */
    .frame{display:grid;grid-template-columns:260px 1fr;gap:18px}
    @media (max-width:980px){ .frame{grid-template-columns:1fr} }

    /* sidebar */
    .side{
      background:linear-gradient(180deg,#e2f1ff,#d7ebff);
      border:1px solid var(--line);
      border-radius:18px; padding:16px;
    }
    .side h3{margin:0 0 8px 0}
    .menu{display:grid;gap:8px;margin-top:10px}
    .menu a{
      display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:12px;
      text-decoration:none;color:#11345c;font-weight:700;border:1px solid #dbe8f6;background:#f3f8ff;
    }
    .menu a.is-active{outline:3px solid #bfe0ff}

    /* card principal */
    .card{
      background:var(--card);border:1px solid var(--line);border-radius:18px;padding:18px;
      box-shadow:0 10px 26px rgba(13,35,60,.06)
    }
    h1{margin:4px 0 12px 0;font-size:30px}

    /* grid do formulário */
    form .grid{
      display:grid;grid-template-columns:1fr 1fr;gap:14px;
    }
    @media (max-width:720px){ form .grid{grid-template-columns:1fr} }

    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-weight:700}
    .input, .select{
      border:1px solid var(--line);border-radius:12px;background:#fff;padding:12px 14px;
      font:inherit;color:var(--ink)
    }
    .row{display:flex;align-items:center;gap:10px}
    .swap{
      width:40px;height:40px;border-radius:12px;border:1px solid var(--line);
      background:var(--pill);cursor:pointer;font-weight:900
    }

    .actions{margin-top:14px;display:flex;gap:10px;align-items:center}
    .btn{border:0;border-radius:14px;padding:12px 18px;font-weight:800;cursor:pointer}
    .btn-primary{background:var(--cta);color:var(--cta-ink);box-shadow:0 8px 18px rgba(255,90,0,.22)}
    .btn-ghost{background:#fff;border:1px solid var(--line)}

    /* mensagens do Django */
    .msgs{margin:10px 0}
    .msg{
      border-radius:12px;padding:12px 14px;margin:8px 0;font-weight:700
    }
    .msg.success{background:#e9fbef;border:1px solid #b9e7c9;color:#0e7b3b}
    .msg.error{background:#ffecec;border:1px solid #ffc5c5;color:#8b1a1a}
    .msg.info{background:#eef6ff;border:1px solid #cfe0ef;color:#0b3b74}

    /* erros inline */
    .err{color:#b00020;font-size:13px;margin-top:2px}
  </style>
</head>
<body>
<div class="wrap">
  <!-- NAV -->
  <nav class="nav" aria-label="primária">
    <div class="brand">Fly Track</div>
    <ul>
      <li><a href="{% url 'core:home' %}">Início</a></li>
      <li><a href="{% url 'core:historico' %}">Histórico de Viagens</a></li>
      <li><a href="{% url 'core:contato' %}">Contato</a></li>
      <li><a class="logout" href="#">Sair</a></li>
    </ul>
  </nav>

  <div class="frame">
    <!-- SIDEBAR -->
    <aside class="side">
      <h3>Admin</h3>
      <div class="menu">
        <a class="is-active" href="#">Cadastrar Voo</a>
        <a href="#">Passageiros</a>
        <a href="#">Passagens</a>
        <a href="#">Pagamentos</a>
        <a href="#">Check-in</a>
        <a href="#">Configurações</a>
      </div>
    </aside>

    <!-- CONTEÚDO -->
    <main class="card" role="main">
      <h1>Cadastrar Voo</h1>
      <p class="muted">Registre um novo voo no sistema. Campos marcados com * são obrigatórios.</p>

      <!-- Django messages -->
      <div class="msgs" aria-live="polite">
        {% if messages %}
          {% for message in messages %}
            <div class="msg {{ message.tags|default:'info' }}">{{ message }}</div>
          {% endfor %}
        {% endif %}
      </div>

      <form id="formVoo" method="post" action="{% url 'core:resultados' %}">
        {% csrf_token %}

        <div class="grid">
          <!-- Número do Voo -->
          <div class="field">
            <label for="numero">Número do Voo *</label>
            <input id="numero" name="numero" class="input" placeholder="Ex.: FT1234" maxlength="10" required>
            <small class="err" id="err-numero"></small>
          </div>

          <!-- Aeronave -->
          <div class="field">
            <label for="aeronave">Aeronave *</label>
            <select id="aeronave" name="aeronave" class="select" required>
              {% if aeronaves %}
                {% for a in aeronaves %}
                <option value="{{ a.pk }}">{{ a.nome }}</option>
                {% endfor %}
              {% else %}
                <option value="A320">Airbus A320</option>
                <option value="B737-800">Boeing 737-800</option>
                <option value="E195-E2">Embraer 195-E2</option>
              {% endif %}
            </select>
          </div>

          <!-- Origem / Destino com botão de inverter -->
          <div class="field">
            <label for="origem">Origem *</label>
            <div class="row">
              <select id="origem" name="origem" class="select" required style="flex:1">
                {% if aeroportos %}
                  {% for ap in aeroportos %}
                  <option value="{{ ap.codigo }}">{{ ap.nome }} ({{ ap.codigo }})</option>
                  {% endfor %}
                {% else %}
                  <option value="GRU">São Paulo — GRU</option>
                  <option value="GIG">Rio de Janeiro — GIG</option>
                  <option value="BSB">Brasília — BSB</option>
                  <option value="CWB">Curitiba — CWB</option>
                  <option value="SSA">Salvador — SSA</option>
                {% endif %}
              </select>
              <button class="swap" type="button" id="swapBtn" title="Inverter Origem/Destino">↕</button>
            </div>
            <small class="err" id="err-rotas"></small>
          </div>

          <div class="field">
            <label for="destino">Destino *</label>
            <select id="destino" name="destino" class="select" required>
              {% if aeroportos %}
                {% for ap in aeroportos %}
                <option value="{{ ap.codigo }}">{{ ap.nome }} ({{ ap.codigo }})</option>
                {% endfor %}
              {% else %}
                <option value="GIG">Rio de Janeiro — GIG</option>
                <option value="GRU">São Paulo — GRU</option>
                <option value="EWR">Newark — EWR</option>
                <option value="POA">Porto Alegre — POA</option>
                <option value="FLN">Florianópolis — FLN</option>
              {% endif %}
            </select>
          </div>

          <!-- Data -->
          <div class="field">
            <label for="data">Data do Voo *</label>
            <input id="data" name="data" type="date" class="input" required>
            <small class="err" id="err-data"></small>
          </div>

          <!-- Horário -->
          <div class="field">
            <label for="hora">Horário de Partida *</label>
            <input id="hora" name="hora" type="time" class="input" required>
            <small class="err" id="err-hora"></small>
          </div>

          <!-- Capacidade -->
          <div class="field">
            <label for="capacidade">Capacidade de Assentos *</label>
            <input id="capacidade" name="capacidade" type="number" min="1" step="1" class="input" placeholder="Ex.: 180" required>
            <small class="err" id="err-capacidade"></small>
          </div>

          <!-- Observação opcional -->
          <div class="field">
            <label for="obs">Observações (opcional)</label>
            <input id="obs" name="obs" class="input" placeholder="Ex.: Operado em codeshare">
          </div>
        </div>

        <div class="actions">
          <button type="submit" class="btn btn-primary">Salvar</button>
          <button type="reset" class="btn btn-ghost">Limpar</button>
        </div>
      </form>
    </main>
  </div>
</div>

<script>
  // === util: hoje ISO ===
  const pad = n => String(n).padStart(2,'0');
  const todayISO = (()=>{const d=new Date();return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`})();

  // refs
  const f = document.getElementById('formVoo');
  const origem = document.getElementById('origem');
  const destino = document.getElementById('destino');
  const dataEl  = document.getElementById('data');
  const horaEl  = document.getElementById('hora');
  const capEl   = document.getElementById('capacidade');
  const numEl   = document.getElementById('numero');

  // mínimos
  if (dataEl) dataEl.min = todayISO;

  // inverter origem/destino
  document.getElementById('swapBtn').addEventListener('click', ()=>{
    const o = origem.value; origem.value = destino.value; destino.value = o;
  });

  // validações simples antes do POST
  f.addEventListener('submit', (e)=>{
    // limpa erros
    ['err-rotas','err-data','err-hora','err-capacidade','err-numero'].forEach(id=>{ const el=document.getElementById(id); if(el) el.textContent=''; });

    let ok = true;

    // Origem ≠ Destino
    if (origem.value === destino.value){
      document.getElementById('err-rotas').textContent = 'Origem e destino devem ser diferentes.';
      ok = false;
    }

    // Data ≥ hoje
    if (!dataEl.value || dataEl.value < todayISO){
      document.getElementById('err-data').textContent = 'Escolha uma data a partir de hoje.';
      ok = false;
    }

    // Horário obrigatório
    if (!horaEl.value){
      document.getElementById('err-hora').textContent = 'Informe o horário de partida.';
      ok = false;
    }

    // Capacidade > 0
    const cap = parseInt(capEl.value,10);
    if (!(cap > 0)){
      document.getElementById('err-capacidade').textContent = 'Capacidade deve ser um inteiro maior que zero.';
      ok = false;
    }

    // Número do voo (formato simples)
    if (!/^[A-Za-z]{1,3}\d{2,5}$/.test(numEl.value||'')){
      document.getElementById('err-numero').textContent = 'Use algo como FT1234 (letras seguidas de números).';
      ok = false;
    }

    if (!ok) e.preventDefault();
  });
</script>
</body>
</html>
